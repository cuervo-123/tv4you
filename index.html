<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi TV Station - Listados y Favoritos</title>
  <style>
     @keyframes pulse {
  0% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); opacity: 0.9; }
}    body {
      background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
justify-content: center;
      padding-top: 60px;
    }
     .container {
      max-width: 1200px;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    .titulo-app {
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.5rem;
      color: #00ffd5;
      font-weight: bold;
      text-shadow: 0 0 10px #00ffd5;
      margin-bottom: 40px;
    }

    .mano-animada {
      width: 45px;
      height: 45px;
      margin-right: 15px;
      animation: moverManoIzq 1s infinite alternate;
      transform: scaleX(-1);
    }

    @keyframes moverManoIzq {
      0% { transform: scaleX(-1) translateX(0); }
      100% { transform: scaleX(-1) translateX(8px); }
    }

    #menuSlider {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background: #191919;
      transition: left 0.3s ease-in-out;
      z-index: 1000;
      padding: 20px 15px;
      border-right: 2px solid #00ffd5;
      box-shadow: 4px 0 15px rgba(0, 255, 213, 0.2);
      overflow-y: auto;
    }

    #menuSlider.open {
      left: 0;
    }

    .menu-item {
      display: inline-flex;
      color: #206d60;
      padding: 12px 15px;
      font-size: 18px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: #2a2a2a;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    .menu-item:hover {
      background: #00ffd5;
      color: #000;
    }

    .submenu {
      display: none;
      padding-left: 15px;
      background: #1a1a1a;
      margin-bottom: 15px;
      border-left: 3px solid #00ffd5;
      border-radius: 4px;
    }

    .submenu-button {
      font-size: 15px;
      margin: 8px 0;
      background: none;
      border: none;
      color: #aaa;
      cursor: pointer;
    }

    .submenu-button:hover {
      color: #00ffd5;
    }

    #openMenuBtn {
      position: relative;
      top: 20px;
      left: 20px;
      font-size: 28px;
      cursor: pointer;
      z-index: 1100;
      color: #00ffd5;
    }

    #favorites-slider {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      max-width: 100%;
      box-shadow: inset 0 0 20px rgba(0, 255, 213, 0.05);
      justify-content: center;
    }

    .favorite-item {
      position: relative;
      min-width: 180px;
      background: #2a2a2a;
      padding: 10px;
      border-radius: 12px;
      text-align: center;
      transition: transform 0.3s ease-in-out;
      box-shadow: 0 4px 10px rgba(0, 255, 213, 0.2);
    }

    .favorite-item img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      margin-bottom: 5px;
      transition: opacity 0.3s;
    }

    .favorite-item:hover {
      transform: scale(1.1);
    }

    .favorite-item:hover img {
      opacity: 0.8;
    }

    .favorite-item .channel-name {
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      margin-top: 10px;
    }

    .favorite-item .hover-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 255, 213, 0.08);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      border-radius: 12px;
    }

    .favorite-item:hover .hover-content {
      opacity: 1;
    }

    .hover-content h4 {
      color: #00ffd5;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .hover-content button {
      padding: 8px 12px;
      background: #00ffd5;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
    }

    #videoPlayer {
      width: 100%;
      max-width: 700px;
      height: auto;
      border-radius: 12px;
      border: 2px solid #00ffd5;
      background-color: #000;
      box-shadow: 0 0 15px rgba(0, 255, 213, 0.3);
      margin-top: 20px;
      display: flex;
      margin-left: auto;
      margin-right: auto;
    }

    .favorite-star {
      font-size: 30px;
      color: gold;
      cursor: pointer;
      margin-top: 15px;
      text-align: center;
      display: block;
      text-shadow: 0 0 10px gold;
    }

    input[type="file"], select, button {
      display: flex;
      margin: 10px 5px;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #333;
      color: #fff;
    }

    button:hover {
      background: #00ffd5;
      color: #000;
    }

    h3 {
      text-align: center;
      margin-top: 30px;
      color: #00ffd5;
    }

    #category-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .category-item {
      background: #2a2a2a;
      padding: 10px;
      border-radius: 8px;
      width: auto;
    }
  </style>



</head>
  <body>
    <h1 class="titulo-app">Mi TV Station
  <div id="openMenuBtn" onclick="toggleMenu()">&#9776;</div>
  <div class="container">
    
      
      <svg class="mano-animada" xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
        <path d="M13.172 11H4a1 1 0 000 2h9.172l-3.586 3.586a1 1 0 101.414 1.414l5.293-5.293a1 1 0 000-1.414l-5.293-5.293a1 1 0 00-1.414 1.414L13.172 11z"/>
      </svg>
      
   </h1>
  </div>

<!-- Bot√≥n para abrir el men√∫ -->
       <div id="openMenuBtn" onclick="toggleMenu()">&#9776;</div>
        <div class="container">
          
            
            

<!-- TODO: CONTENIDO DE TU HTML AQU√ç SIN CAMBIOS -->

<!-- Aqu√≠ va TODO EL CONTENIDO EXACTO QUE YA TEN√çAS, desde el <div id="menuSlider"> hasta tu script -->
<!-- Te lo mantuve intacto como me pediste. Solo tienes que pegar esa parte debajo de este comentario -->






<div id="menuSlider">

  <h3>MENU</h3>
  
  

    <button class="menu-item" onclick="toggleSubMenu('favorites')">        Favoritos</button>
    <div id="submenu-favorites" class="submenu">
    <!-- Aqu√≠ se pueden agregar m√°s opciones del submen√∫ de Favoritos -->
    <button class="submenu-button" onclick="showFavorites()">Ver Favoritos</button>
    </div>
    
    <button class="menu-item" onclick="toggleSubMenu('channels')">Canales</button>
    <div id="submenu-channels" class="submenu">
    <!-- Aqu√≠ se agregan las categor√≠as din√°micas -->
    <div id="category-list"></div>
    </div>
    
    <button class="menu-item" onclick="toggleSubMenu('settings')">Configuraciones</button>
    <div id="submenu-settings" class="submenu">
    <!-- Aqu√≠ se pueden agregar m√°s opciones del submen√∫ de Configuraciones -->
    <button class="submenu-button" onclick="regenerarCanalesInternos()">Regenerar Canales VOD Internos</button>
    <button class="submenu-button" onclick="verCanalesInternos()">Ver Canales Internos</button>
    </div>
    </div>
    
    <!-- Contenido principal -->
    <div>
        <input type="file" id="fileInput" accept=".json,.m3u,.mp3,.mpeg">
        <input type="text" id="buscador" placeholder="üîç Buscar canal..." oninput="filtrarCanales()" style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;background:#222;color:#00ffd5;border:1px solid #00ffd5;">

    <div>
    <label for="channel-select">Canales:</label>
    <select id="channel-select" onchange="playSelectedChannel()"></select>
    <img id="channel-logo" style="width: 100px; height: auto; margin-top: 10px; border-radius: 8px; display: none;" />

    <button onclick="addToFavorites()">Agregar a Favoritos</button>
    <button onclick="showFavorites()">Ver Favoritos</button>
    </div>
    
    <div>
    <h3>Categor√≠as Detectadas:</h3>
    <div id="category-list"></div>
    </div>
    <video id="videoPlayer"
           controls
           autoplay
           muted
           playsinline
           style="width:100%; max-width:700px; background:#000; border-radius:12px; border:2px solid #00ffd5;"
           poster="https://via.placeholder.com/640x360?text=Cargando+video">
      Tu navegador no soporta la reproducci√≥n de video en vivo.
    </video>
  </main>

  <script>
    let channelsData = [];
    let favoritos = JSON.parse(localStorage.getItem('favoritos') || '[]');

    function playChannel(url) {
      const video = document.getElementById('videoPlayer');
      if (window.hls) {
        window.hls.destroy();
        window.hls = null;
      }
      video.src = url;
      video.load();
      video.play();
    }

    function playSelectedChannel() {
      const select = document.getElementById('channel-select');
      const url = select.value;
      if (url) playChannel(url);
    }

    function parseM3U(content) {
      const lines = content.split('\n');
      const channels = [];
      let currentTitle = '';
      lines.forEach((line, index) => {
        line = line.trim();
        if (line.startsWith('#EXTINF')) {
          const titleMatch = line.match(/,(.*)$/);
          currentTitle = titleMatch ? titleMatch[1].trim() : `Canal ${index}`;
        } else if (line && !line.startsWith('#')) {
          channels.push({ title: currentTitle, url: line });
          currentTitle = '';
        }
      });
      return channels;
    }

    function parseJSON(content) {
      try {
        const data = JSON.parse(content);
        return Array.isArray(data) ? data : [];
      } catch (e) {
        alert('‚ùå Archivo JSON inv√°lido');
        return [];
      }
    }

    function cargarCanales(channels) {
      const select = document.getElementById('channel-select');
      select.innerHTML = '';
      channels.forEach((channel, index) => {
        const option = document.createElement('option');
        option.value = channel.url;
        option.textContent = channel.title;
        select.appendChild(option);
      });
      if (channels.length > 0) {
        select.selectedIndex = 0;
        playChannel(channels[0].url);
      }
    }

    function filtrarCanales() {
      const input = document.getElementById('buscador').value.toLowerCase();
      const select = document.getElementById('channel-select');
      select.innerHTML = '';
      channelsData.forEach(channel => {
        if (channel.title.toLowerCase().includes(input)) {
          const option = document.createElement('option');
          option.value = channel.url;
          option.textContent = channel.title;
          select.appendChild(option);
        }
      });
    }

    function agregarAFavoritos() {
      const select = document.getElementById('channel-select');
      const index = select.selectedIndex;
      if (index >= 0) {
        const canal = channelsData[index];
        if (!favoritos.find(f => f.url === canal.url)) {
          favoritos.push(canal);
          localStorage.setItem('favoritos', JSON.stringify(favoritos));
          alert('‚úÖ Canal agregado a favoritos');
        } else {
          alert('‚ö†Ô∏è Ya est√° en favoritos');
        }
      }
    }

    function mostrarFavoritos() {
      const contenedor = document.getElementById('favoritos-list');
      contenedor.innerHTML = '<h3>‚≠ê Favoritos:</h3>';
      favoritos.forEach(fav => {
        const div = document.createElement('div');
        div.className = 'favorito-item';
        div.textContent = fav.title;
        div.onclick = () => playChannel(fav.url);
        contenedor.appendChild(div);
      });
      contenedor.style.display = 'block';
    }

    function mostrarSeccion(seccion) {
      const favoritosList = document.getElementById('favoritos-list');
      if (seccion === 'favoritos') {
        mostrarFavoritos();
      } else {
        favoritosList.style.display = 'none';
      }
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const content = e.target.result;
        if (file.name.endsWith('.m3u')) {
          channelsData = parseM3U(content);
        } else if (file.name.endsWith('.json')) {
          channelsData = parseJSON(content);
        }
        cargarCanales(channelsData);
      };
      reader.readAsText(file);
    }

    window.addEventListener('DOMContentLoaded', () => {
      fetch("https://cuervo-123.github.io/mi-tv-station/update3.m3u")
        .then(res => res.text())
        .then(data => {
          console.log("‚úÖ Contenido m3u:", data.slice(0, 300));
          const canales = parseM3U(data);
          console.log("‚úÖ Canales parseados:", canales);
          if (canales.length === 0) {
            alert("‚ö†Ô∏è No se encontraron canales en update3.m3u");
          }
          channelsData = canales;
          cargarCanales(channelsData);
        })
        .catch(err => {
          console.error("‚ùå Error al cargar update3.m3u:", err);
        });
    });

function filtrarCanales() {
  const input = document.getElementById('buscador').value.toLowerCase();
  const channelSelect = document.getElementById('channel-select');
  channelSelect.innerHTML = '';

  channelsData.forEach((channel, index) => {
    if (channel.title.toLowerCase().includes(input)) {
      const option = document.createElement('option');
      option.value = index;
      option.innerText = channel.title;
      channelSelect.appendChild(option);
    }
  });
}


    

    fetch("update3.m3u")
      .then(res => res.text())
      .then(data => {
        const canales = parseM3U(data);
        mostrarCanales(canales, true);
        console.log("‚úÖ Lista M3U cargada autom√°ticamente");
      })
      .catch(err => console.error("‚ùå Error al cargar la lista M3U:", err));

function renderAutoCargados() {
  const contenedor = document.getElementById('contenedor-autocanales');
  contenedor.innerHTML = '';

  channelsData.forEach((channel, index) => {
    const card = document.createElement('div');
    card.style.width = '180px';
    card.style.background = '#2a2a2a';
    card.style.borderRadius = '12px';
    card.style.padding = '10px';
    card.style.textAlign = 'center';
    card.style.boxShadow = '0 4px 10px rgba(0,255,213,0.2)';

    const thumb = document.createElement('img');
    thumb.src = channel.thumbnail || `https://via.placeholder.com/320x180?text=${encodeURIComponent(channel.title)}`;
    thumb.style.width = '100%';
    thumb.style.borderRadius = '8px';
    thumb.style.marginBottom = '8px';

    const name = document.createElement('div');
    name.textContent = channel.title;
    name.style.color = '#fff';
    name.style.fontSize = '14px';
    name.style.marginBottom = '5px';

    const btn = document.createElement('button');
    btn.textContent = '‚ñ∂Ô∏è Play';
    btn.style.background = '#00ffd5';
    btn.style.color = '#000';
    btn.style.border = 'none';
    btn.style.padding = '5px 10px';
    btn.style.borderRadius = '6px';
    btn.style.cursor = 'pointer';
    btn.onclick = () => playChannel(channel.url);

    card.appendChild(thumb);
    card.appendChild(name);
    card.appendChild(btn);
    contenedor.appendChild(card);
  });
}
// ‚úÖ Cargar autom√°ticamente el archivo update.m3u al abrir la app
window.addEventListener('DOMContentLoaded', () => {
  fetch('update3.m3u') // O usa 'update%20.m3u' si tu archivo tiene espacio
    .then(res => res.text())
    .then(text => {
      if (text.includes("#EXTM3U")) {
        channelsData = parseM3U(text);
        console.log("üîç Canales detectados:", channelsData);
        console.log("‚úÖ update2.m3u cargado correctamente");
        loadChannels();
        renderAutoCargados(); // üëâ Esto muestra los canales en el contenedor visual
      } else {
        console.warn("‚ö† El archivo no parece ser un M3U v√°lido");
      }
    })
    .catch(err => {
      console.warn("‚ùå No se pudo cargar update2.m3u:", err);
    });
});
    
  </script>
</body>
</html>
