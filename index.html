<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE APP TV GLOBAL STATION ¬∑ Tech Blue</title>

  <style>
    :root{
      --bg0:#020512;
      --bg1:#050a1f;
      --panel:#070d24;
      --panel2:#0b1430;
      --line:rgba(79,155,255,.24);
      --text:#eaf2ff;
      --muted:#9fb1cb;
      --accent:#1f8bff;
      --accent2:#4ac3ff;
      --ok:#21d07a;
      --warn:#f6b73c;
      --danger:#ff6b6b;
      --radius:14px;
      --shadow:0 0 18px rgba(31,139,255,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(circle at 20% -20%, #0b1a3d 0%, var(--bg0) 38%, #020312 100%);
      color: var(--text);
    }

    header, main { max-width: 1200px; margin: 0 auto; padding: 14px; }

    .topbar{
      background: linear-gradient(180deg, rgba(15,27,51,.92), rgba(7,12,24,.92));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    h1{
      margin:0 0 10px;
      color: var(--accent2);
      letter-spacing:.3px;
      text-shadow:0 0 10px rgba(74,195,255,.35);
      font-size: 18px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    select, input[type="text"], input[type="file"]{
      width:100%;
      padding:.62rem .72rem;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(9,16,36,.75);
      color: var(--text);
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.15);
    }
    input[type="text"]::placeholder{ color: rgba(159,177,203,.8); }

    select:focus, input[type="text"]:focus{
      border-color: rgba(74,195,255,.65);
      box-shadow: 0 0 0 3px rgba(31,139,255,.18);
    }

    .btn{
      padding:.62rem .85rem;
      border-radius: 12px;
      border: 1px solid rgba(31,139,255,.35);
      background: rgba(31,139,255,.18);
      color: var(--text);
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{
      background: rgba(74,195,255,.22);
      border-color: rgba(74,195,255,.55);
      transform: translateY(-1px);
    }
    .btn.primary{
      background: linear-gradient(90deg, rgba(31,139,255,.85), rgba(74,195,255,.55));
      border-color: rgba(74,195,255,.65);
    }
    .btn.danger{
      background: rgba(255,107,107,.12);
      border-color: rgba(255,107,107,.35);
    }

    /* Player */
    .player-wrap{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    #videoPlayer{
      width:100%;
      height: 52vh;
      max-height: 560px;
      background:#000;
      border-radius: var(--radius);
      border: 1px solid rgba(74,195,255,.35);
      box-shadow: var(--shadow);
      display:block;
    }

    /* Sections */
    .section{
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(15,27,51,.85), rgba(7,12,24,.85));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .section-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(74,195,255,.18);
    }
    .section-title{
      font-weight: 900;
      color: var(--accent2);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .section-title small{
      color: var(--muted);
      font-weight: 800;
      opacity:.9;
    }

    /* Carousel strip */
    .strip-wrap{ position:relative; }
    .strip{
      display:flex;
      flex-wrap:nowrap;
      overflow-x:auto;
      gap:10px;
      padding: 12px;
      scroll-behavior:smooth;
    }
    .strip::-webkit-scrollbar{ height:8px; }
    .strip::-webkit-scrollbar-track{ background: rgba(0,0,0,.2); }
    .strip::-webkit-scrollbar-thumb{ background: rgba(31,139,255,.55); border-radius: 999px; }

    .arrow{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border:1px solid rgba(74,195,255,.35);
      background: rgba(0,0,0,.45);
      color:#fff;
      display:grid;
      place-items:center;
      cursor:pointer;
      z-index:5;
      font-size: 1.4rem;
    }
    .arrow:hover{ background: rgba(31,139,255,.35); }
    .arrow.left{ left:8px; }
    .arrow.right{ right:8px; }

    /* Channel card */
    .card{
      position:relative;
      flex: 0 0 auto;
      min-width: 240px;
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px;
      border-radius: 14px;
      border:1px solid rgba(74,195,255,.18);
      background: rgba(9,16,36,.65);
      cursor:pointer;
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
      user-select:none;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(74,195,255,.55);
      box-shadow: 0 8px 18px rgba(0,0,0,.28), 0 0 14px rgba(31,139,255,.14);
    }
    .logo{
      width:44px; height:44px;
      border-radius: 12px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(74,195,255,.18);
      overflow:hidden;
      display:grid;
      place-items:center;
      flex: 0 0 44px;
    }
    .logo img{ width:100%; height:100%; object-fit: cover; display:block; }
    .meta{ min-width:0; display:flex; flex-direction:column; gap:2px; }
    .name{
      font-weight: 900;
      color: var(--text);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 170px;
    }
    .host{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 170px;
    }

    /* Favorite star */
    .fav{
      position:absolute;
      top:8px; right:8px;
      width: 34px; height:34px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .fav span{ font-size: 18px; color: rgba(255,255,255,.65); transform: translateY(-1px); }
    .card.isFav{ border-color: rgba(246,208,77,.6); }
    .card.isFav .fav span{ color: #f6d04d; text-shadow: 0 0 10px rgba(246,208,77,.25); }

    /* Poster mode */
    body.poster-mode .card{
      min-width: 320px;
      align-items:flex-start;
    }
    body.poster-mode .logo{
      width:92px; height:124px; border-radius: 14px;
      flex: 0 0 92px;
    }
    body.poster-mode .name{ max-width: 200px; font-size: 1.05rem; }
    body.poster-mode .host{ max-width: 200px; font-size: .82rem; }

    /* Drop zone */
    .drop{
      border: 1px dashed rgba(74,195,255,.35);
      background: rgba(31,139,255,.08);
      border-radius: 14px;
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .drop strong{ color: var(--accent2); }
    .drop small{ color: var(--muted); }
    .drop.dragover{
      background: rgba(74,195,255,.14);
      border-color: rgba(74,195,255,.7);
      box-shadow: 0 0 0 3px rgba(31,139,255,.14);
    }

    .hint{
      color: var(--muted);
      font-size: 12px;
      margin-top: 8px;
      opacity: .9;
    }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <h1>üì∫ THE APP TV GLOBAL STATION <span style="color:var(--muted);font-weight:800;">¬∑ Tech Blue</span></h1>

      <div class="grid">
        <div>
          <div class="row">
            <select id="selectorPais">
              <option value="https://cuervo-123.github.io/tv4you/paises/listado canales en espanol .m3u">Listado canales en espa√±ol</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/lg.m3u">LG</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/latam.m3u">Latam</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/ssungusa.m3u">Samsung USA</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/global.m3u">Global</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/colombia.m3u">üá®üá¥ Colombia</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/brazil.m3u">Brazil</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/xumo.m3u">Xumo</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/xiaomi.m3u">Xiaomi</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/localnow.m3u">LocalNow</option>
            </select>
          </div>

          <div class="row" style="margin-top:10px;">
            <select id="selectorPais2">
              <option value="https://cuervo-123.github.io/tv4you/paises/Deportes.m3u">Deportes</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/Noticias.m3u">Noticias</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/Cine.m3u">Cine</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/Musica.m3u">M√∫sica</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/Series.m3u">Series</option>
              <option value="https://cuervo-123.github.io/tv4you/paises/Infantil.m3u">Infantil</option>
            </select>
          </div>
        </div>

        <div>
          <input id="buscador" type="text" placeholder="Buscar canal..." />

          <div class="row" style="margin-top:10px;">
            <button class="btn primary" id="btnSoloFav">‚≠ê Solo Favoritos</button>
            <button class="btn" id="btnVerTodos">üì∫ Ver Todos</button>
            <button class="btn" id="btnPoster">üñºÔ∏è Posters</button>
            <button class="btn danger" id="btnClearFav">üßπ Borrar Fav</button>
          </div>

          <div class="drop" id="dropZone" style="margin-top:10px;">
            <div>
              <strong>üì§ Upload Listado</strong>
              <div><small>Soporta: .m3u / .m3u8 / .w3u / .json ¬∑ tambi√©n puedes arrastrar aqu√≠</small></div>
            </div>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
              <input id="fileInput" type="file" accept=".m3u,.m3u8,.w3u,.json,application/json,text/plain" />
              <button class="btn" id="btnLoadDemo">‚ö° Cargar update3.m3u</button>
            </div>
          </div>

          <div class="hint">Tip: si el archivo es gigante, mejor .m3u (texto) y evita logos muy pesados.</div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="player-wrap">
      <video id="videoPlayer" controls playsinline></video>

      <div class="section">
        <div class="section-head">
          <div class="section-title">‚≠ê Favoritos <small id="favCount">(0)</small></div>
        </div>
        <div class="strip-wrap">
          <button class="arrow left" onclick="scrollStrip('favStrip', -1)">‚¨ÖÔ∏è</button>
          <div class="strip" id="favStrip"></div>
          <button class="arrow right" onclick="scrollStrip('favStrip', 1)">‚û°Ô∏è</button>
        </div>
      </div>

      <div class="section">
        <div class="section-head">
          <div class="section-title">üïò Recientes <small id="recCount">(0)</small></div>
        </div>
        <div class="strip-wrap">
          <button class="arrow left" onclick="scrollStrip('recStrip', -1)">‚¨ÖÔ∏è</button>
          <div class="strip" id="recStrip"></div>
          <button class="arrow right" onclick="scrollStrip('recStrip', 1)">‚û°Ô∏è</button>
        </div>
      </div>

      <div class="section">
        <div class="section-head">
          <div class="section-title">üì∫ Canales <small id="chCount">(0)</small></div>
        </div>
        <div class="strip-wrap">
          <button class="arrow left" onclick="scrollStrip('chStrip', -1)">‚¨ÖÔ∏è</button>
          <div class="strip" id="chStrip"></div>
          <button class="arrow right" onclick="scrollStrip('chStrip', 1)">‚û°Ô∏è</button>
        </div>
      </div>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const video = document.getElementById("videoPlayer");

    const favStrip = document.getElementById('favStrip');
    const recStrip = document.getElementById('recStrip');
    const chStrip  = document.getElementById('chStrip');

    const favCountEl = document.getElementById('favCount');
    const recCountEl = document.getElementById('recCount');
    const chCountEl  = document.getElementById('chCount');

    const buscador = document.getElementById('buscador');

    const FAV_KEY = "TB_GLOBAL_FAV_V1";
    const REC_KEY = "TB_GLOBAL_REC_V1";
    const POSTER_KEY = "TB_GLOBAL_POSTER_V1";
    const MAX_REC = 24;

    let listaOriginalCanales = [];
    let hlsInstance = null;

    function saveJson(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function loadJson(key, fallback){
      try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
      catch { return fallback; }
    }

    function normKey(c){ return (c?.url || "").trim(); }

    function loadFavs(){ return loadJson(FAV_KEY, []); }
    function saveFavs(arr){ saveJson(FAV_KEY, arr); }

    function loadRecs(){ return loadJson(REC_KEY, []); }
    function saveRecs(arr){ saveJson(REC_KEY, arr); }

    function isFav(c){
      const favs = loadFavs();
      return favs.some(f => normKey(f) === normKey(c));
    }

    function toggleFav(c){
      const favs = loadFavs();
      const key = normKey(c);
      const idx = favs.findIndex(f => normKey(f) === key);
      if(idx >= 0) favs.splice(idx, 1);
      else favs.push({ nombre: c.nombre || 'Canal', url: c.url, logo: c.logo || '' });
      saveFavs(favs);
      renderFavoritos();
      renderCanalesActual(); // refresca estrellas
    }

    function addRecent(c){
      const rec = loadRecs();
      const key = normKey(c);
      const filtered = rec.filter(r => normKey(r) !== key);
      filtered.unshift({ nombre: c.nombre || 'Canal', url: c.url, logo: c.logo || '' });
      saveRecs(filtered.slice(0, MAX_REC));
      renderRecientes();
    }

    function playCanal(c){
      if(!c?.url) return;

      if(hlsInstance){
        try{ hlsInstance.destroy(); }catch(e){}
        hlsInstance = null;
      }

      const url = c.url;

      if (window.Hls && Hls.isSupported() && /\.m3u8(\?|$)/i.test(url)) {
        hlsInstance = new Hls();
        hlsInstance.loadSource(url);
        hlsInstance.attachMedia(video);
        hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(()=>{}));
      } else if (video.canPlayType && video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', () => video.play().catch(()=>{}), { once:true });
      } else {
        video.src = url;
        video.play().catch(()=>{});
      }

      addRecent(c);
    }

    function hostFromUrl(url){
      try { return new URL(url).hostname; } catch { return ''; }
    }

    function createCard(c){
      const card = document.createElement('div');
      card.className = 'card';
      if(isFav(c)) card.classList.add('isFav');

      const fav = document.createElement('div');
      fav.className = 'fav';
      fav.innerHTML = `<span>${isFav(c) ? '‚òÖ' : '‚òÜ'}</span>`;
      fav.title = isFav(c) ? 'Quitar de favoritos' : 'Agregar a favoritos';
      fav.onclick = (ev)=>{ ev.stopPropagation(); toggleFav(c); };

      const logo = document.createElement('div');
      logo.className = 'logo';

      if(c.logo){
        const img = document.createElement('img');
        img.src = c.logo;
        img.alt = c.nombre || 'logo';
        img.onerror = () => { logo.textContent = 'üì∫'; };
        logo.appendChild(img);
      } else {
        logo.textContent = 'üì∫';
      }

      const meta = document.createElement('div');
      meta.className = 'meta';

      const name = document.createElement('div');
      name.className = 'name';
      name.textContent = c.nombre || 'Canal';

      const host = document.createElement('div');
      host.className = 'host';
      host.textContent = hostFromUrl(c.url) || '';

      meta.appendChild(name);
      meta.appendChild(host);

      card.appendChild(fav);
      card.appendChild(logo);
      card.appendChild(meta);

      card.onclick = ()=> playCanal(c);

      return card;
    }

    function renderStrip(el, arr){
      el.innerHTML = '';
      if(!arr || !arr.length){
        const empty = document.createElement('div');
        empty.style.padding = '10px 12px';
        empty.style.color = 'var(--muted)';
        empty.textContent = 'Vac√≠o‚Ä¶';
        el.appendChild(empty);
        return;
      }
      const frag = document.createDocumentFragment();
      arr.forEach(c => frag.appendChild(createCard(c)));
      el.appendChild(frag);
    }

    function renderFavoritos(){
      const favs = loadFavs();
      favCountEl.textContent = `(${favs.length})`;
      renderStrip(favStrip, favs);
    }
    function renderRecientes(){
      const rec = loadRecs();
      recCountEl.textContent = `(${rec.length})`;
      renderStrip(recStrip, rec);
    }
    function renderCanales(canales, guardarOriginal=false){
      if(guardarOriginal) listaOriginalCanales = canales || [];
      chCountEl.textContent = `(${(canales||[]).length})`;
      renderStrip(chStrip, canales || []);
      renderFavoritos();
      renderRecientes();
    }

    function renderCanalesActual(){
      // respeta filtro del buscador
      const q = (buscador.value || '').trim().toLowerCase();
      if(!q){ renderCanales(listaOriginalCanales, false); return; }
      const filtrados = listaOriginalCanales.filter(c => (c.nombre||'').toLowerCase().includes(q));
      renderCanales(filtrados, false);
    }

    window.scrollStrip = function(id, dir){
      const el = document.getElementById(id);
      if(!el) return;
      el.scrollBy({ left: 340 * dir, behavior: 'smooth' });
    }

    buscador.addEventListener('input', renderCanalesActual);

    document.getElementById('btnSoloFav').addEventListener('click', ()=>{
      const favs = loadFavs();
      if(!favs.length) return alert('No tienes favoritos todav√≠a.');
      renderCanales(favs, false);
    });

    document.getElementById('btnVerTodos').addEventListener('click', ()=>{
      buscador.value = '';
      renderCanales(listaOriginalCanales, false);
    });

    document.getElementById('btnClearFav').addEventListener('click', ()=>{
      if(!confirm('¬øBorrar TODOS los favoritos?')) return;
      saveFavs([]);
      renderFavoritos();
      renderCanalesActual();
    });

    function applyPosterMode(on){
      document.body.classList.toggle('poster-mode', !!on);
      localStorage.setItem(POSTER_KEY, on ? '1' : '0');
      document.getElementById('btnPoster').textContent = on ? 'üñºÔ∏è Posters: ON' : 'üñºÔ∏è Posters';
    }
    document.getElementById('btnPoster').addEventListener('click', ()=>{
      applyPosterMode(!document.body.classList.contains('poster-mode'));
    });

    /* ===================== PARSERS (M3U/W3U/JSON) ===================== */
    function parseM3U(text){
      const clean = (text||'').replace(/^\uFEFF/, '').replace(/\r\n?/g, '\n');
      const lines = clean.split('\n');
      const out = [];

      for(let i=0;i<lines.length;i++){
        const line = (lines[i]||'').trim();
        if(!line || line.startsWith('#EXTM3U')) continue;

        if(line.startsWith('#EXTINF')){
          const comma = line.indexOf(',');
          const nombre = (comma !== -1) ? (line.slice(comma+1).trim() || 'Canal') : 'Canal';

          const logoMatch = line.match(/tvg-logo="(.*?)"/i);
          const logo = logoMatch ? logoMatch[1] : '';

          const url = (lines[i+1]||'').trim();
          if(url && /^https?:\/\//i.test(url)){
            out.push({ nombre, url, logo });
            i++;
          }
          continue;
        }

        // l√≠neas URL sueltas
        if(/^https?:\/\//i.test(line)){
          out.push({ nombre: line.split('/').slice(-1)[0] || 'Canal', url: line, logo:'' });
        }
      }
      return out;
    }

    function parseW3U(text){
      // En la pr√°ctica suele ser igual que M3U (texto). Lo tratamos igual:
      return parseM3U(text);
    }

    function parseJSONChannels(text){
      const data = JSON.parse(text);
      if(!Array.isArray(data)) throw new Error('JSON debe ser un array');
      return data.map(x => ({
        nombre: x.nombre || x.name || x.title || 'Canal',
        url: x.url || x.stream || x.link || '',
        logo: x.logo || x.tvgLogo || x.image || x.poster || ''
      })).filter(c => c.url && /^https?:\/\//i.test(c.url));
    }

    async function loadFromTextByExt(text, ext){
      let canales = [];
      if(ext === 'json'){
        canales = parseJSONChannels(text);
      }else if(ext === 'w3u'){
        canales = parseW3U(text);
      }else{
        canales = parseM3U(text); // m3u / m3u8 / txt
      }
      renderCanales(canales, true);
    }

    async function loadFromUrl(url){
      const res = await fetch(url, { cache:'no-store' });
      if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      const text = await res.text();
      // inferir extensi√≥n
      const ext = (url.split('?')[0].split('.').pop() || '').toLowerCase();
      await loadFromTextByExt(text, ext === 'w3u' ? 'w3u' : ext === 'json' ? 'json' : 'm3u');
    }

    /* ===================== Upload + Drop ===================== */
    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', async (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const name = file.name || '';
      const ext = (name.split('.').pop() || '').toLowerCase();
      try{
        const text = await file.text();
        await loadFromTextByExt(text, ext === 'w3u' ? 'w3u' : ext === 'json' ? 'json' : 'm3u');
      }catch(err){
        alert('No pude leer ese archivo. Revisa que sea .m3u/.w3u/.json v√°lido.');
        console.error(err);
      }finally{
        e.target.value = '';
      }
    });

    const dropZone = document.getElementById('dropZone');
    ;['dragenter','dragover'].forEach(evt=>{
      dropZone.addEventListener(evt, (e)=>{
        e.preventDefault();
        dropZone.classList.add('dragover');
      });
    });
    ;['dragleave','drop'].forEach(evt=>{
      dropZone.addEventListener(evt, (e)=>{
        e.preventDefault();
        dropZone.classList.remove('dragover');
      });
    });
    dropZone.addEventListener('drop', async (e)=>{
      const file = e.dataTransfer?.files?.[0];
      if(!file) return;
      const ext = (file.name.split('.').pop()||'').toLowerCase();
      try{
        const text = await file.text();
        await loadFromTextByExt(text, ext === 'w3u' ? 'w3u' : ext === 'json' ? 'json' : 'm3u');
      }catch(err){
        alert('Drop: archivo inv√°lido o da√±ado.');
        console.error(err);
      }
    });

    /* ===================== Selectores ===================== */
    document.getElementById("selectorPais").addEventListener("change", function () {
      loadFromUrl(this.value).catch(e=> alert('Error cargando lista: ' + e.message));
    });
    document.getElementById("selectorPais2").addEventListener("change", function () {
      loadFromUrl(this.value).catch(e=> alert('Error cargando lista: ' + e.message));
    });

    document.getElementById('btnLoadDemo').addEventListener('click', ()=>{
      loadFromUrl("update3.m3u").catch(e=> alert('No pude cargar update3.m3u: ' + e.message));
    });

    /* ===================== INIT ===================== */
    renderFavoritos();
    renderRecientes();
    applyPosterMode(localStorage.getItem(POSTER_KEY) === '1');

    // Carga default (igual que tu versi√≥n)
    loadFromUrl("update3.m3u").catch(()=> {
      // fallback demo
      renderCanales([
        { nombre:'DEMO HLS', url:'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8', logo:'' },
        { nombre:'DEMO BBB', url:'https://test-streams.mux.dev/bbb-abr/bbb.m3u8', logo:'' }
      ], true);
    });
  </script>
</body>
</html>
